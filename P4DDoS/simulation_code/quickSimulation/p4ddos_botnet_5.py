# !/usr/bin/python
# -*- coding:utf-8 -*-
# ###########################
# File Name: cal.py
# Author: dingdamu
# Mail: dingdamu@gmail.com
# Created Time: 2020-01-21 17:50:23
# ###########################

import math
from collections import Counter



def log2ES(x):
    m = 4
    pre =3
    w = x | (x >> 1)
    w = w | (w >> 2)
    w = w | (w >> 4)
    w = w | (w >> 8)
    w = w | (w >> 16)
    w = w | (w >> 32)
    b = (w & 0x5555555555555555) + ((w >> 1) & 0x5555555555555555)
    b = (b & 0x3333333333333333) + ((b >> 2) & 0x3333333333333333)
    b = (b & 0x0f0f0f0f0f0f0f0f) + ((b >> 4) & 0x0f0f0f0f0f0f0f0f)
    b = (b & 0x00ff00ff00ff00ff) + ((b >> 8) & 0x00ff00ff00ff00ff)
    b = (b & 0x0000ffff0000ffff) + ((b >> 16) & 0x0000ffff0000ffff)
    b = (b & 0x00000000ffffffff) + ((b >> 32) & 0x00000000ffffffff)
    n = b - 1
    if n - m < 0:
        k = x - (1 << n)
        n_b = 1 << n
    else:
        k = ((x - (1 << n)) >> (n-m))
        n_b = (((1 << m)))
    log2x = n*1024 + int(round(math.log2(1 + (k/n_b)), pre) *1024)
    return log2x

Hnorm = [724, 699, 699, 735, 735, 735, 735, 675, 735, 735, 699, 735, 735, 735, 735, 735, 735, 735, 735, 735, 735, 735, 735, 735, 735, 699, 735, 735, 735, 735, 735, 735, 735, 735, 735, 699, 735, 699, 735, 699, 699, 699, 699, 699, 699, 699, 699, 699, 699, 699]
EWMA =727
alpha = 0.13
epsilon = 0.01
theta = 0.01
ewma_eta = 273
nsrcList =[19805, 27847, 28177, 27821, 28025, 27262, 27135, 27491, 26881, 28584, 27618, 26729, 27084, 27770, 27923, 28761, 27440, 27491, 27339, 27720, 24556, 28075, 27084, 26424, 27110, 26907, 27389, 27694, 27440, 27720, 26856, 27339, 27237, 27466, 27389, 27084, 27135, 27491, 27440, 27618, 27313, 27110, 26856, 27237, 27339, 26780, 26983, 27618, 27567, 27643]

ndstList = [16019, 21368, 22892, 22981, 23388, 23121, 23273, 24302, 23019, 22829, 21990, 21622, 21545, 22841, 21990, 22435, 22193, 22066, 22206, 22663, 18725, 21990, 21990, 22562, 21126, 22892, 22117, 22765, 22524, 21939, 21596, 22016, 22841, 22104, 21596, 21304, 21126, 20999, 22409, 22270, 21774, 21723, 22752, 22270, 22524, 22600, 21609, 21838, 22422, 21787]

ddosList = []
for i in range(0, 50):
    ddos = 0
    nsrc = nsrcList[i]
    ndst = ndstList[i]
    eta = log2ES(nsrc) - log2ES(ndst)
    if (Hnorm[i] < EWMA-epsilon*1024):
        ddos = 1
    ddosList.append(ddos)
print(ddosList)
a1 = Counter(ddosList)
p1 = a1[1]/50
print(p1)
# HList
# [9896, 10214, 10214, 10434, 10373, 10373, 10292, 10045, 10596, 10596, 10146, 10434, 10292, 10596, 10292, 10373, 10292, 10292, 10693, 10373, 10569, 10693, 10292, 10539, 10292, 10146, 10292, 10292, 10596, 10292, 10292, 10373, 10373, 10596, 10373, 10146, 10373, 10214, 10434, 10146, 10045, 10214, 10214, 10214, 10214, 10146, 10146, 10045, 10045, 10016]
# HsrcList
# [11232, 11678, 11678, 11930, 11917, 11917, 11880, 11613, 12196, 12196, 11654, 11930, 11880, 12196, 11880, 11917, 11880, 11880, 11917, 11917, 11785, 11917, 11880, 11875, 11880, 11654, 11880, 11880, 12196, 11880, 11880, 11917, 11917, 11880, 11917, 11654, 11613, 11678, 11654, 11654, 11613, 11678, 11398, 11678, 11966, 11654, 11654, 11613, 11613, 11168]
# HnormList
# [724, 699, 699, 735, 735, 735, 735, 675, 735, 735, 699, 735, 735, 735, 735, 735, 735, 735, 735, 735, 735, 735, 735, 735, 735, 699, 735, 735, 735, 735, 735, 735, 735, 735, 735, 699, 735, 699, 735, 699, 699, 699, 699, 699, 699, 699, 699, 699, 699, 699]
# nsrcList
# [19805, 27847, 28177, 27821, 28025, 27262, 27135, 27491, 26881, 28584, 27618, 26729, 27084, 27770, 27923, 28761, 27440, 27491, 27339, 27720, 24556, 28075, 27084, 26424, 27110, 26907, 27389, 27694, 27440, 27720, 26856, 27339, 27237, 27466, 27389, 27084, 27135, 27491, 27440, 27618, 27313, 27110, 26856, 27237, 27339, 26780, 26983, 27618, 27567, 27643]
# ndstList
# [16019, 21368, 22892, 22981, 23388, 23121, 23273, 24302, 23019, 22829, 21990, 21622, 21545, 22841, 21990, 22435, 22193, 22066, 22206, 22663, 18725, 21990, 21990, 22562, 21126, 22892, 22117, 22765, 22524, 21939, 21596, 22016, 22841, 22104, 21596, 21304, 21126, 20999, 22409, 22270, 21774, 21723, 22752, 22270, 22524, 22600, 21609, 21838, 22422, 21787]

